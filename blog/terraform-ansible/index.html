<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>Terraform & Ansible | The Oops Guy</title><meta content="Terraform & Ansible" property=og:title><meta content="Pawan Chhetri" name=author><meta content=en-US property=og:locale><meta content="terraform and ansible, one after other" name=description><meta content="terraform and ansible, one after other" property=og:description><link href=https://pawanchhetri.com.np/blog/terraform-ansible/ rel=canonical><meta content=https://pawanchhetri.com.np/blog/terraform-ansible/ property=og:url><meta content="The Oops Guy" property=og:site_name><meta content=article property=og:type><meta content=2023-04-12T00:00:00+00:00 property=article:published_time><meta content=summary name=twitter:card><meta content="Terraform & Ansible" property=twitter:title><meta content="terraform and ansible, one after other" name=description><title>Terraform & Ansible</title><link href=/img/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/img/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/img/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><style>body{--primary-color:#376dd9;--primary-pale-color:#698bcf1c;--inline-code-color:#444;--text-color:#444;--text-pale-color:#545967;--bg-color:#fff;--highlight-mark-color:#5f75b045;--callout-note-color:#3e70d6;--callout-important-color:#7a46cd;--callout-warning-color:#d3822b;--callout-alert-color:#d43f3f;--callout-question-color:#3089b5;--callout-tip-color:#35a06b;--main-font:"IBMPlexSans",ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--code-font:"IBMPlexMono",ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--homepage-max-width:750px;--main-max-width:750px;--avatar-size:175px;--paragraph-font-size:16px;--paragraph-line-height:1.5em;--aside-font-size:16px;--img-border-radius:4px;--inline-code-border-radius:2px}body.dark{--primary-color:#689afd;--primary-pale-color:#93acdd1c;--inline-code-color:#d2d2d2;--text-color:#ddd;--text-pale-color:#a0a0a0;--bg-color:#202124;--highlight-mark-color:#5f75b045;--callout-note-color:#698bcf;--callout-important-color:#9374c5;--callout-warning-color:#c99054;--callout-alert-color:#d35757;--callout-question-color:#5091b2;--callout-tip-color:#3ea06f}</style><link href=/main.css rel=stylesheet><body class=post><script>if(localStorage.getItem('theme')=='dark'){document.body.classList.add('dark');const a=document.querySelector('link#hl');if(a)a.href='/hl-dark.css'}</script><header class=blur><div id=header-wrapper><nav><a href=/>The Oops guy</a><button aria-label="toggle expand" class=separator id=toggler>::</button><span class="wrap left fold">{</span><a href=/blog>blog</a><span class="wrap-separator fold">,</span><a class=fold href=/projects>projects</a><span class="wrap right fold">} ;</span></nav><div id=btns><a aria-label="rss feed" href=/blog/atom.xml><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M3 17C5.20914 17 7 18.7909 7 21H3V17ZM3 10C9.07513 10 14 14.9249 14 21H12C12 16.0294 7.97056 12 3 12V10ZM3 3C12.9411 3 21 11.0589 21 21H19C19 12.1634 11.8366 5 3 5V3Z" fill=currentColor></path></svg></a><a rel="noreferrer noopener" aria-label=GitHub href=https://github.com/Pawan-666 target=_blank> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" fill=currentColor></path></svg> </a><a rel="noreferrer noopener" aria-label=Twitter href=https://twitter.com/PawanCh09197754 target=_blank> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" fill=currentColor></path></svg> </a><a rel="noreferrer noopener" aria-label=LinkedIn href=https://www.linkedin.com/in/pawan-chhetri-a91821169/ target=_blank> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" fill=currentColor></path></svg> </a><button aria-label="theme switch" data-moon-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill="currentColor"></path></svg>' data-sun-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z" fill="currentColor"></path></svg>' id=theme-toggle><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill=currentColor></path></svg></button><button aria-label="table of content" id=toc-toggle><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M3 4H21V6H3V4ZM3 11H15V13H3V11ZM3 18H21V20H3V18Z" fill=currentColor></path></svg></button></div></div></header><div id=wrapper><div id=blank></div><aside class=blur><nav><ul><li><a class=h2 href=#terraform>Terraform</a><li><a class=h2 href=#ansible>Ansible</a></ul></nav><button aria-label="back to top" id=back-to-top><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M11.9997 10.8284L7.04996 15.7782L5.63574 14.364L11.9997 8L18.3637 14.364L16.9495 15.7782L11.9997 10.8284Z" fill=currentColor></path></svg></button></aside><main><div><div data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z" fill="currentColor"></path></svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>' id=copy-cfg style=display:none></div><article data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M9.41421 8L18.0208 16.6066L16.6066 18.0208L8 9.41421V17H6V6H17V8H9.41421Z" fill="currentColor"></path></svg>' class=prose><h1>Terraform & Ansible</h1><div id=post-info><div id=date><span id=publish>2023-04-12</span></div><div id=tags><a href=https://pawanchhetri.com.np/tags/terraform><span>#</span>terraform</a><a href=https://pawanchhetri.com.np/tags/ansible><span>#</span>ansible</a><a href=https://pawanchhetri.com.np/tags/aws><span>#</span>aws</a></div></div><p>   In this blog post, we will explore how DevOps teams can leverage IAC tools to simplify their infrastructure management and deployment processes using terraform and then ansible one after other. I’m going to make a server on AWS using Terraform and configure server, install necessary packages using ansible for web page deployment which will display <code>Hello World!</code> on its port 80.<h2 id=terraform>Terraform<a aria-label="Anchor link for: terraform" class=zola-anchor href=#terraform>#</a></h2><p><img alt src=/images/2023-04-18-21-27-20.png>     <strong>Terraform</strong> is an open-source tool for managing infrastructure resources as code, allowing developers to define and manage their infrastructure declaratively using a configuration file. It supports multiple cloud providers and on-premises infrastructure and provides a consistent and repeatable way to provision and manage resources. Prior to running the code and commands below you should have an aws account(free-tier works too), terraform and ansible installed. Make an IAM user and set <a rel="nofollow noreferrer" href=https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html>aws_cli</a> on your local machine to use that user’s IAM credentials. AWS uses the concept of Identity Access Management(IAM) to manage resource allocation to different users/groups and this allows us to use different IAM setup for different projects.<p><code>cat main.tf</code> #make this file in any directory you want<pre class=language-bash data-lang=bash style=background:#2e3440;color:#d8dee9><code class=language-bash data-lang=bash><span style=color:#616e88>#making resources in Singapore
</span><span style=color:#88c0d0>provider </span><span style=color:#a3be8c>"aws" </span><span>{      
</span><span>  region  = </span><span style=color:#a3be8c>"ap-southeast-1"
</span><span>}
</span><span>
</span><span style=color:#616e88>#supply your pc public key, type ssh-keygen and press enter multiple times to create new
</span><span style=color:#88c0d0>resource </span><span style=color:#a3be8c>"aws_key_pair" "key_pair" </span><span>{
</span><span>  key_name = </span><span style=color:#a3be8c>"mynewkeypair"
</span><span>  public_key = </span><span style=color:#a3be8c>"</span><span style=color:#81a1c1>$</span><span style=color:#a3be8c>{</span><span>file(</span><span style=color:#a3be8c>"/home/pawan/.ssh/id_rsa.pub"</span><span>)</span><span style=color:#a3be8c>}"  
</span><span>  
</span><span>}
</span><span>
</span><span style=color:#616e88>#making a free-tier ubuntu virtual machine
</span><span style=color:#88c0d0>resource </span><span style=color:#a3be8c>"aws_instance" "web_server" </span><span>{     
</span><span>  ami           = </span><span style=color:#a3be8c>"ami-0a72af05d27b49ccb"
</span><span>  instance_type = </span><span style=color:#a3be8c>"t2.micro"
</span><span>  key_name      = </span><span style=color:#a3be8c>"mynewkeypair"  
</span><span>
</span><span>  tags = {
</span><span>    Name = </span><span style=color:#a3be8c>"WebServerInstance"
</span><span>  }
</span><span>
</span><span>  vpc_security_group_ids = </span><span style=color:#81a1c1>[</span><span>aws_security_group.web_server_sg.id</span><span style=color:#81a1c1>]
</span><span>}
</span><span>
</span><span style=color:#616e88>#adding firewall/security_group rules for ssh,http and outgoing traffic
</span><span style=color:#88c0d0>resource </span><span style=color:#a3be8c>"aws_security_group" "web_server_sg" </span><span>{    
</span><span>  name_prefix = </span><span style=color:#a3be8c>"web_server_sg"
</span><span>
</span><span>  ingress {
</span><span>    from_port = 22
</span><span>    to_port   = 22
</span><span>    protocol  = </span><span style=color:#a3be8c>"tcp"
</span><span>    cidr_blocks = </span><span style=color:#81a1c1>[</span><span style=color:#a3be8c>"0.0.0.0/0"</span><span style=color:#81a1c1>]
</span><span>  }
</span><span>
</span><span>  ingress {
</span><span>    from_port = 80
</span><span>    to_port   = 80
</span><span>    protocol  = </span><span style=color:#a3be8c>"tcp"
</span><span>    cidr_blocks = </span><span style=color:#81a1c1>[</span><span style=color:#a3be8c>"0.0.0.0/0"</span><span style=color:#81a1c1>]
</span><span>  }
</span><span>
</span><span>  egress {
</span><span>    from_port   = 0
</span><span>    to_port     = 0
</span><span>    protocol    = </span><span style=color:#a3be8c>"-1"
</span><span>    cidr_blocks = </span><span style=color:#81a1c1>[</span><span style=color:#a3be8c>"0.0.0.0/0"</span><span style=color:#81a1c1>]
</span><span>  }
</span><span>}
</span><span>
</span><span style=color:#616e88>#data blocks invokes the previously deployed resources
</span><span style=color:#88c0d0>data </span><span style=color:#a3be8c>"aws_instance" "web_server_data" </span><span>{
</span><span>  instance_id = aws_instance.web_server.id
</span><span>}
</span><span>
</span><span style=color:#616e88>#displaying the public ip of the server on terminal
</span><span style=color:#88c0d0>output </span><span style=color:#a3be8c>"public_ip" </span><span>{   
</span><span>  value = data.aws_instance.web_server_data.public_ip
</span><span>}
</span></code></pre><p>It’s essential that you execute the commands below from the same directory where the above file is at.<p><code>terraform init</code> #checks all the configuration files inside the current working directory and downloads the plugins required according to the resources defined<p><img alt src=/images/2023-04-12-14-52-03.png><p><code>terraform plan</code> #shows what is going to be provisioned in details if applied<p><img alt src=/images/2023-04-12-14-55-54.png><p><code>terraform apply</code> #when we do <code>terraform apply</code> it prompts us for conformation, we should reply it with <code>yes</code> to proceed to provision the server on aws .<p><img alt src=/images/2023-04-12-15-21-43.png><p><code>public_ip</code> variable is set above to display the public ip of the server, which ansible will use to ssh into the machine and run the ansible_playbook which we’ll write below.<p>We can check the aws console on the browser to confirm the above terraform configuration.<p><img alt src=/images/2023-04-12-15-28-42.png><p>The <code>Name</code> supplied in the above <code>main.tf</code> matches with the configured server and the public_ip is same as displayed during <code>terraform apply</code>. Make note of that ip, since we’ll be using this ip to provision web server. Do ssh into this new machine and add the id_rsa.pub file into the new server.<p><code>ssh ubuntu@54.255.87.157</code> #ssh should work , which is the necessay condition to run the below ansible playbook<h2 id=ansible>Ansible<a aria-label="Anchor link for: ansible" class=zola-anchor href=#ansible>#</a></h2><p>    <strong>Ansible</strong> is an open-source automation tool that allows developers to automate the deployment and management of infrastructure resources. It uses YAML to define infrastructure as code and supports multiple operating systems and cloud providers. Ansible is agentless, making it easy to manage and scale infrastructure environments. Ansible uses a main file considered as playbook which contains instructions to run on remote servers.<p><code>cat aws_playbook.yml</code> #make a file called aws_playbook and paste this content<pre class=language-yaml data-lang=yaml style=background:#2e3440;color:#d8dee9><code class=language-yaml data-lang=yaml><span>- </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Getting new servers IP address
</span><span>  </span><span style=color:#8fbcbb>hosts</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>localhost
</span><span>  </span><span style=color:#8fbcbb>gather_facts</span><span style=color:#eceff4>: </span><span style=color:#81a1c1>no
</span><span>  </span><span style=color:#8fbcbb>vars_prompt</span><span style=color:#eceff4>:         </span><span style=color:#616e88>#prompts to ask server public ip
</span><span>    - </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>target_host
</span><span>      </span><span style=color:#8fbcbb>prompt</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Please provide the IP of the new server
</span><span>      </span><span style=color:#8fbcbb>private</span><span style=color:#eceff4>: </span><span style=color:#81a1c1>no
</span><span>  </span><span style=color:#8fbcbb>tasks</span><span style=color:#eceff4>:
</span><span>    - </span><span style=color:#8fbcbb>add_host</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>name="{{ target_host }}" groups=dynamically_created_hosts
</span><span>
</span><span>- </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Preapring the new server
</span><span>  </span><span style=color:#8fbcbb>remote_user</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>ubuntu
</span><span>  </span><span style=color:#8fbcbb>hosts</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>dynamically_created_hosts   
</span><span>  </span><span style=color:#8fbcbb>gather_facts</span><span style=color:#eceff4>: </span><span style=color:#81a1c1>no
</span><span>  </span><span style=color:#8fbcbb>become</span><span style=color:#eceff4>: </span><span style=color:#81a1c1>yes
</span><span>  </span><span style=color:#8fbcbb>become_user</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>root
</span><span>  </span><span style=color:#8fbcbb>become_method</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>sudo
</span><span>  </span><span style=color:#8fbcbb>vars</span><span style=color:#eceff4>:
</span><span>    </span><span style=color:#8fbcbb>ansible_ssh_port</span><span style=color:#eceff4>: </span><span style=color:#b48ead>22
</span><span>  </span><span style=color:#8fbcbb>tasks</span><span style=color:#eceff4>:
</span><span>    - </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Update and Upgrade apt packages to the latest available
</span><span>      </span><span style=color:#8fbcbb>apt</span><span style=color:#eceff4>:
</span><span>        </span><span style=color:#8fbcbb>update_cache</span><span style=color:#eceff4>: </span><span style=color:#81a1c1>yes
</span><span>        </span><span style=color:#8fbcbb>cache_valid_time</span><span style=color:#eceff4>: </span><span style=color:#b48ead>3600
</span><span>        </span><span style=color:#8fbcbb>upgrade</span><span style=color:#eceff4>: </span><span style=color:#81a1c1>yes
</span><span>
</span><span>    - </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Installing necessary packages 
</span><span>      </span><span style=color:#8fbcbb>apt</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>name={{ item }} state=present
</span><span>      </span><span style=color:#8fbcbb>with_items</span><span style=color:#eceff4>:
</span><span>        - </span><span style=color:#a3be8c>vim
</span><span>        - </span><span style=color:#a3be8c>tmux
</span><span>        - </span><span style=color:#a3be8c>nginx
</span><span>
</span><span>    - </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Enable ufw firewall
</span><span>      </span><span style=color:#8fbcbb>ufw</span><span style=color:#eceff4>:
</span><span>        </span><span style=color:#8fbcbb>state</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>enabled
</span><span>        </span><span style=color:#8fbcbb>rule</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>allow
</span><span>        </span><span style=color:#8fbcbb>proto</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>tcp
</span><span>        </span><span style=color:#8fbcbb>port</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>"{{ item }}"
</span><span>      </span><span style=color:#8fbcbb>with_items</span><span style=color:#eceff4>:
</span><span>        - </span><span style=color:#b48ead>22
</span><span>        - </span><span style=color:#b48ead>80
</span><span>
</span><span>    - </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Create "Hello World" HTML file 
</span><span>      </span><span style=color:#8fbcbb>copy</span><span style=color:#eceff4>:
</span><span>        </span><span style=color:#8fbcbb>content</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>"&LTh1>Hello World&LT/h1>"
</span><span>        </span><span style=color:#8fbcbb>dest</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>"/var/www/html/index.html"
</span><span>        </span><span style=color:#8fbcbb>mode</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>"0644"
</span><span>
</span><span>    - </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>Start Nginx service
</span><span>      </span><span style=color:#8fbcbb>service</span><span style=color:#eceff4>:
</span><span>        </span><span style=color:#8fbcbb>name</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>nginx
</span><span>        </span><span style=color:#8fbcbb>state</span><span style=color:#eceff4>: </span><span style=color:#a3be8c>started
</span><span>        </span><span style=color:#8fbcbb>enabled</span><span style=color:#eceff4>: </span><span style=color:#81a1c1>true
</span></code></pre><p><code>ansible-playbook  aws_playbook.yml</code> #runs the above file, which asks for the public_ip of the server we just provisioned above. <img alt src=/images/2023-04-12-16-55-20.png>    The yellow color lines are the changes made on the server and green ones are not changed, since those configurations exist already. Ansible follows the idempotency philoshopy, thus no matter how many times you run this file, only the new changes are going to be applied, the changes which align with the configuration files remain unchanged.<p><img alt src=/images/2023-04-12-17-03-32.png> Btw, our web server is up.<p><code>terraform destroy</code> #this deletes the sever from the aws, it prompts us and we have to supply <code>yes</code> to delete the server <img alt src=/images/2023-04-12-17-05-32.png><p>If we refresh the aws console, it says that web server is terminated, which gets removed after a while.<img alt src=/images/2023-04-12-17-06-37.png><p>   You can add more stuffs to both the terraform and ansible files above to do much more.<p><strong>Images above are scraped through kodekloud,google except screenshots</strong></article><div class=giscus></div><script async crossorigin data-category=General data-category-id=DIC_kwDOL6heGM4CfTnr data-emit-metadata=0 data-input-position=bottom data-lang=en data-loading=lazy data-mapping=pathname data-reactions-enabled=1 data-repo=Pawan-666/website_new_theme data-repo-id=R_kgDOL6heGA data-strict=0 data-theme=preferred_color_scheme src=https://giscus.app/client.js></script></div><footer><div class=copyright><p>© 2024 Pawan Chhetri</div><div class=credits>Powered by <a rel="noreferrer noopener" href=https://www.getzola.org target=_blank>zola</a> and <a rel="noreferrer noopener" href=https://github.com/isunjn/serene target=_blank>serene</a></div></footer></main></div><script src=/js/lightense.min.js></script><script src=/js/main.js></script>